# 反復タスク一覧 (Tasks)

このドキュメントは、このプロジェクトで繰り返し発生するタスクの標準的なワークフローを記録します。

## 新しいデータ表示・編集ページの追加

**概要:**
SvelteKitのファイルベースルーティングを利用して、特定のデータ（例: ノート）の詳細表示ページと編集ページを作成する際の標準的な手順です。

**関連ファイルの例 (ノートの場合):**
- `src/routes/notes/[id]/+page.svelte`: 詳細表示ページ
- `src/routes/notes/[id]/edit/+page.svelte`: 編集ページ
- `src/routes/api/notes/[id]/+server.ts`: データアクセスAPI

**ステップ:**

1.  **APIエンドポイントの実装 (`+server.ts`)**
    - `GET`リクエストハンドラを作成し、パスパラメータ（例: `id`）に基づいてデータベースから単一のレコードを取得するロジックを実装します。
    - `PUT`リクエストハンドラを作成し、リクエストボディのデータでレコードを更新するロジックを実装します。
    - `DELETE`リクエストハンドラを作成し、レコードを削除するロジックを実装します。
    - Drizzle ORMを使用して、型安全なデータベース操作を行います。
    - 認証をチェックし、適切なユーザーのみがデータにアクセスできるようにします。

2.  **詳細表示ページの実装 (`+page.svelte`)**
    - `+page.server.ts` の `load` 関数内で、`fetch` を使用して対応するAPIエンドポイント（`GET /api/notes/{id}`）を呼び出し、データを取得します。
    - 取得したデータをページに表示します。タイトル、内容、関連情報（タグ、作成日時など）を適切にフォーマットします。
    - 編集ページへのリンクと、削除ボタンを配置します。

3.  **編集ページの実装 (`edit/+page.svelte`)**
    - `+page.server.ts` の `load` 関数で、表示ページと同様にデータを取得し、フォームの初期値として設定します。
    - フォーム (`<form>`) と入力フィールド（`input`, `textarea`など）を作成します。UIにはDaisyUIコンポーネントを優先的に使用します。
    - SvelteKitのフォームアクションを使用して、フォーム送信時に`PUT`リクエストをAPIエンドポイントに送信し、データを更新します。
    - 更新が成功したら、詳細表示ページにリダイレクトします。

**重要事項:**
- **認証:** すべてのデータアクセスと操作は、`src/hooks.server.ts` を通じて認証されていることを前提とします。APIエンドポイントと `load` 関数の両方で、ユーザーセッションを適切に処理する必要があります。
- **型安全:** `src/lib/types.ts` やDrizzleのスキーマから型をインポートし、コンポーネントとAPI間のデータの受け渡しを型安全に行います。
## Markdownプレビュー表示のカスタマイズ

**概要:**
メモのプレビュー表示で、Markdownの特定の要素（太字、リンク、インラインコードなど）をHTMLとして表示する機能の実装とカスタマイズに関するタスクです。

**関連ファイル:**
- `src/lib/components/MemoCard.svelte`: メモのプレビュー表示コンポーネント

**ステップ:**
1.  **要件の確認:**
    - どのMarkdown要素をHTMLとして表示する必要があるかを確認します（例: 太字、リンク、インラインコード）。
    - 表示の制限やセキュリティ上の考慮事項を確認します。

2.  **実装の検討:**
    - MarkdownをHTMLに変換するライブラリ（markedなど）を使用します。
    - HTMLタグをフィルタリングして、許可された要素のみを保持する処理を実装します。
    - テキストの切り捨て処理をHTML対応にするか検討します。

3.  **コンポーネントの修正:**
    - プレビュー表示部分で`{@html}`ディレクティブを使用してHTMLコンテンツをレンダリングします。
    - CSSスタイルを調整して、HTMLコンテンツがカード内に適切に表示されるようにします。

4.  **テストと検証:**
    - 各Markdown要素が正しく表示されることを確認します。
    - セキュリティ上のリスクがないか評価します。
    - レスポンシブデザインが崩れていないか確認します。

**重要事項:**
- **セキュリティ:** 信頼できないHTMLをレンダリングするとXSSのリスクがあります。適切なサニタイズ処理を実装する必要があります。
- **パフォーマンス:** 複雑なHTML処理はパフォーマンスに影響する可能性があります。必要に応じて最適化を検討します。
- **UI/UX:** HTML要素のスタイルが全体のデザインと調和するようにCSSを調整します。
- **UI/UX:** DaisyUIのコンポーネントとテーマカラーを利用して、一貫性のあるUIを構築します。